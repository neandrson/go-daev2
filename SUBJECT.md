
# Распределённый вычислитель арифметических выражений.
 
Пользователь хочет считать арифметические выражения. Он вводит строку `2 + 2 * 2` и хочет получить в ответ `6`. Но наши операции сложения и умножения (также деления и вычитания) выполняются "очень-очень" долго. Поэтому вариант, при котором пользователь делает http-запрос и получает в качетсве ответа результат, невозможна. Более того, вычисление каждой такой операции в нашей "альтернативной реальности" занимает "гигантские" вычислительные мощности. Соответственно, каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин". Поэтому пользователь может с какой-то периодичностью уточнять у сервера "не посчиталость ли выражение"? Если выражение наконец будет вычислено - то он получит результат. Помните, что некоторые части арифметического выражения можно вычислять параллельно.
 
## Back-end часть
Состоит из 2 элементов:
 
- Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения. Далее будем называть его "оркестратором".
 
- Вычислитель, который может получить от "оркестратора" задачу, выполнить его и вернуть серверу результат. Далее будем называть его "агентом".
 
### 1. Оркестратор
Сервер, который имеет следующие endpoint-ы:


#### Добавление вычисления арифметического выражения
 
```
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
      "id": <уникалиный идентификатор выраженя>
      "expression": <строка с выражение>
}'
```


Коды ответа:
201 - выражение принято для вычисления
422 - невалидные данные
500 - что-то пошло не так
 
Тело ответа


```
{
      "id":
}

```
 

#### Получение списка выражений
 
```
curl --location 'localhost/api/v1/expressions'


```
 
Тело ответа


```
{
          "expressions": [
                {
                      "id": <идентификатор выражения>,
                      "status": <статус вычисления выражения>,
                      "result": <результат выражения>
                },
                {
                      "id": <идентификатор выражения>,
                      "status": <статус вычисления выражения>,
                      "result": <результат выражения>
                 }
            ]
}

```

Коды ответа:
* 200 - успешно получен список выражений
* 500 - что-то пошло не так
 
#### Получение выражения по его идентификатору
 
```
curl --location 'localhost/api/v1/expressions/:id'
 
```

Коды ответа:
* 200 - успешно получено выражение
* 404 - нет такого выражения
* 500 - что-то пошло не так
 
Тело ответа
 
```
{
       "expression":
             {

                    "id": <идентификатор выражения>,
                    "status": <статус вычисления выражения>,
                    "result": <результат выражения>
              }
 }
 
```
 
#### Получение задачи для выполения.
 
```
curl --location 'localhost/internal/task'
 
```

Коды ответа:
* 200 - успешно получена задача
* 404 - нет задачи
* 500 - что-то пошло не так
 
Тело ответа

```
{
       "task":
             {
                   "id": <идентификатор задачи>,
                   "arg1": <имя первого аргумента>,
                   "arg2": <имя второго аргумента>,
                   "operation": <операция>,
                   "operation_time": <время выполнения операции>
              }
}
 
```

Время выполнения операций задается переменными среды в милисекундах:
 
- TIME_ADDITION_MS - время выполнения операции сложения в милисекундах
- TIME_SUBTRACTION_MS - время выполнения операции вычитания в милисекундах
- TIME_MULTIPLICATIONS_MS - время выполнения операции умножения в милисекундах
- TIME_DIVISIONS_MS - время выполнения операции деления в милисекундах
 
 
#### Прием результата обработки данных.
 
```
curl --location 'localhost/internal/task' \
--header 'Content-Type: application/json' \
--data '{
      "id": 1,
      "result": 2.5
}'
 
```
 
Коды ответа:
* 200 - успешно записан результа
* 404 - нет такой задачи
* 422 - невалидные данные
* 500 - что-то пошло не так
 

### 2. Агент

Демон, который получает выражение для вычисления с сервера, вычисляет его и отправляет на сервер результат выражения.

При старте демон запускает несколько горутин, каждая из которых выступает в роли независимого вычислителя. Количество горутин регулируется переменной среды
COMPUTING_POWER
 
Агент обязательно общается с оркестратором по http
Агент все время приходит к оркестратору с запросом "дай задачку поработать" (в ручку GET internal/task для получения задач). Оркестратор отдаёт задачу.

Агент производит вычисление и в ручку оркестратора (POST internal/task для приёма результатов обработки данных) отдаёт результат
 

## Front-end часть
Если есть энтузизам - то предлагаем реализовать веб интерфейс над написанным вами API на свой вкус
 

## Правила оформления:
 
- Проект размещен на github (В решение задания в LMS вы прикрепляете именно ссылку на github с вашим проектом! Обязательно проверьте, что ссылка имеет публичный доступ и проверяющий вашей работы точно сможет по ней перейти)
 
- Проект снабжен Readme файлом - где подробно описано, о чем проект и как им пользоваться
 
- Проект снабжен примерами использования с помощью curl (который покрывает разные сценарии: всё хорошо, ошибки)
 
```
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
      "expression": "2+2*2"
}'


```

- Отдельным блоком в документации идёт инструкция по запуску проекта (желательно, чтобы можно было просто скопировать какую-то команду и запустить ей проект)
 
```
go run ./cmd/calc_service/...
 
```
 

## Критерии оценки

Так как вы будете проверять работы друг друга после дедлайна на решение, ниже представлены подробные критерии оценки.
 
1. Существует Readme документ, в котором описано, как запустить систему и как ей пользоваться.
- Это может быть docker-compose, makefile, подробная инструкция - на ваш вкус
- в Readme описаны примеры запросов с помощью curl-a или любым дргуми понятными образом
- примеры полны и понятно, как их запустить
- у системы есть документация со схемами, которая наглядно отвечает на вопрос: "Как это всё работает"
Этот пункт дает 10 баллов. Без наличия такого файла - решение не проверяется.

2. Программа запускается, и все примеры с вычислением арифметических выражений корректно работают - 10 баллов

3. Программа запускается и выполняются произвольные примеры с вычислением арифметических выражений - 10 баллов

4. Вам понятна кодовая база и структура проекта - 10 баллов (это субъективный критерий, но чем проще ваше решение - тем лучше).
Проверяющий в этом пункте честно отвечает на вопрос: "Смогу я сделать пулл-реквест в проект без нервного срыва"
 
5. Наличие веб-интерфейса даёт дополнительные 10 баллов
 
Не стремитесь получить 50, стремитесь сделать на все 100% ту часть, которую вы собираетесь делать.
Как говорил В.И. Ленин: "Лучше меньше, да лучше"

ВАЖНО:
Если проверяющему непонятно, как запустить приложение (в документации ничего не написано) - сразу ставим 0 (уточнение у автора запрашивать не нужно)

